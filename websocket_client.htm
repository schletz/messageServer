<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <style type="text/css">
        p {
            margin:0px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        var sendUrl = "http://localhost:25221/sendMessage";
        var receiveUrl = "http://localhost:25221/getMessages";
        var websocketServer = "ws://localhost:25222/chatserver";
        var count = 0;
    </script>
    <script type="text/javascript">
        var ws = new WebSocket(websocketServer);
        ws.onerror = function (err) {
            console.log(event.data);
        };
        ws.onopen = function (event) {
            ws.send("Neuer Client meldet sich.");
        };
        ws.onmessage = function (event) {
            data = JSON.parse(event.data);
            appendMessages(data);
        };
    </script>
    <script type="text/javascript">
        function sendLogin()
        {
            var username = $('#username').val();
            var passwort = $('#passwort').val();
            console.log(btoa(username + ":" + passwort));
            $.post
            ({
                url: "http://localhost:25221/login",
                data: {username: username, password: passwort},
                success: function () {
                    $.get(receiveUrl, function (data) {
                        appendMessages(data);
                    });
                }
            });
        }
        function appendMessages(data)
        {
            if (!Array.isArray(data))
                data = [data];
            for (var i = 0; i < data.length; i++) {
                $('#messages').append("<p>" + data[i].M_Message + "</p>");
            }
        }
        function sendMessage()
        {
            $.post(sendUrl, { message: $('#message').val() });
        }
        $(function () {
            $('#send').on("click", sendMessage);
            $('#login').on("click", sendLogin);

        })
    </script>
</head>
<body>
    <form action="#">
        <p>Username: <input type="text" size="20" name="username" id="username" /></p>
        <p>Passwort: <input type="text" size="20" name="passwort" id="passwort" /> <a href="#" id="login">Anmelden</a></p>

        <p>Nachricht: <input type="text" size="40" name="message" id="message"/></p>
        <p><a href="#" id="send">Über das Webservice auf Port 25221 senden.</a></p>
    </form>
    <div id="messages">

    </div>
</body>
</html>